Размер ломаной - количество отрезков, из которых она составлена.

Будем обозначать точки ломаной размера n, как {p_0, ..., p_n}, так,
чтобы точки одного отрезка имели соседние индексы.
Очевидно, что точки каждой прямой могут быть поименованы двумя способами.

После индексации точек появляется возможность определить правую и левую сторону ломаной.
Будем говорить, что сторона левая, если при движении вдоль ломаной в порядке возрастания вершин,
ломаная находится справа, иначе сторона правая.

Назовем зоной видимости ломаной такую область, откуда видны все отрезки
этой ломаной.

Рассмотрим ломаную из двух отрезков.
Очевидно, что из любой точки зоны видимости ломаной видны,
либо две правые стороны отрезков, либо две левые. 
Таким образом, для произвольной ломаной из двух отрезков
ответ "да" означает видимость одной из ее сторон.

Из этого следует утверждение и для произвольной ломаной:
Для произвольной ломаной ответ "да" означает видимость одной из ее сторон.

Теорема. Зона видимости произвольной ломаной это <= 2 выпуклых многоугольника (возможно бесконечных).

Допустим с одной стороны от ломаной существует некоторая зона видимости.
Ее выпуклость следует из построения зон видимости множества отрезков.

Возьмем произвольную точку внутри зоны и начнем двигать в произвольном направлении.
Возможны два случая:
	1) Из данной точки невозможно покинуть зону видимости двигаясь в выбранном направлении.
	2) В какой-то момент мы покинем зону видимости.

Во втором случае зона всегда кончается в тот момент, когда мы пересекаем прямую построенную
на одном из отрезков цепи (начинаем видеть его не с той стороны).

Понятно, что при дальнейшем движении в выбранном направлении видимая сторона этого отрезка
больше никогда не изменится.

Этот факт, а также то, что у ломанной всего две комбинации сторон отрезков могут 
порождать зоны с ответом "да" гарантируют, что количество зон видимости для ломаной
не превосходит 2. Возможность вариантов 0, 1 можно считать доказанной построением.

Алгоритм нахождения точки, входящей в зону видимости для k ломаных:

1.1. Для каждой ломаной строим прямую строго разделяющую ее зоны видимости.
	(Ломаные с 0 зон видимости автоматически приводят к ответу "нет")
	O(nlog(n))
1.2. Строим Arragment на полученных прямых. В каждой грани РСДС однозначно определена
	одна из двух зон видимости для каждой ломаной. Назовем такие зоны допустимыми.
	O(k^2)
1.3. Обходим РСДС и для каждой грани O(k^2), полученного РСДС, находим пересечение допустимых 
	в ней зон видимости.
	O(nlog(n))

2.1. Выбираем случайную точку q в построенном пересечении,
	относительно этой точки находим крайние точки ломанных по полярному углу,
	это будут концы ломанных[1']. Строим упорядоченный массив крайних точек (обозначим P_q)
	O(klog(k))
2.2. Назовем ломаную правильной относительно точки q, если крайние точки ломаной t_1, t_m - соседи в P_q, 
	при движении по ломанной от t_1 к t_m все тройки q t_i t_(i+1) образовывают левый поворот, в предположении,
	что t_1 находится в P_q раньше t_m. Если ломаная всего одна, то она правильная.
	Если все ломаные правильные, то они все видны.
2.3. Иначе строим k^2 прямых соединяющие все концы ломанных.
	O(k^2)
2.4. Совершаем обход по полученному упорядочению,
	если для какой-то грани все ломанные правильные, то ответ "да",
	если такой грани нет, то ответ "нет".
	O(k^4)


O(nlog(n) + k^2 + k^2 * nlog(n) + k^2 * (klog(k) + k^4)) = O(k^6 + k^2 * nlog(n))

Так как для каждой из k^2 граней строится упорядочение на одних и тех же крайних точках ломанной,
то это упорядочение можно построить один раз, до обхода граней.
Тогда суммарное число гранией во всех пересечениях k^4.

Тогда суммарна сложность будет иметь вид
O(nlog(n) + k^2 + k^2 * nlog(n) + k^4 + k^2 * (klog(k) + n) + k^4) = O(k^4 + k^2 * nlog(n))

[1']
Утверждение.
Для любой точки p в пересечении зон видимости ломанных наибольшую разность среди всех пар точек одной ломанной
в значении полярного угла относительно точки p будут иметь крайние точки ломанной.

Доказательство.
Пусть это не так, и для какой-то ломанной l существует точка p', для которой крайними по полярному углу будут точки q1, qr,
не умаляя общности, будем считать, что только qr не является крайней точкой ломанной l.
Будем считать, что q1, qs крайние точки ломанной l (l содержит s вершин).
Тогда для любого i = 1..r-1 треугольник qi_p'_qi+1 будет иметь один и тот же знак площади (для определённости +) так как angle(qi, p') < angle(qi+1, p'),
а это значит, что p' лежит с одной и той же стороны для всех отрезков qi_qi+1 (для определённости с левой).
Но так как q_r крайняя точка по полярному углу, то angle(qr, p') > angle(qr+1, p'), тогда треугольник qr_p'_qr+1 будет иметь отрицательную площадь,
и тогда p' будет находиться с права от отрезка qr_qr+1.
Но так как для любой точки зоны видимости ломанной эта точка лежит с одной и той же стороны относительно всех отрезков этой ломанной, получили противоречие,
с тем, что точка p' принадлежит пересечению зон видимостей всех ломанных. #

Статус - упорядоченные по полярному углу концы ломанных, количество правильных ломаных.


Теорема.
Статус не зависит от выбора точки внури грани.

Доказательство.
TODO

Теорема.
В процессе перешагивания грани статус меняется не значительно

Доказательство.
TODO


Случай П-ломаных.

Определение.
Назовем П-ломаной такую ломаную, которая состоит ровно из трех отрезков, крайние отрезки параллельны,
центральный перпендикулярен двум другим.

Утверждение.
Зона видимости П-ломаной - бесконечный прямоугольник.

Предлагается следующий алгоритм для решения задачи поиска всех зон видимости для множества П-ломаных:

Реализуем его инкрементально:

1. Находим зону видимости для произвольной П-ломаной из множества.
2. Последовательно добавляем все остальный П-ломаные, пересчитывая зону видимости:
	2.1. Находим зону видимости k-ой добавляемой П-ломаной.
	2.2. Находим пересечение зоны видимости первых k-1 ломаных и k-ой, если оно пусто - ответ нет,
		 иначе найденное пересечение - максимально возможная зона видимости первых k ломаных.
	2.3. Рассмотри взаимное положение каждой из уже добавленных ломанных с k-ой.
		 В случае каждой пары добавляются прямые (луч? максимум одна, две?), каждая из которых
		 корректирует зону видимости k-ой ломаной. Возможных взаимных положений двух П-ломаных
		 с разными корректирующими прямыми конечное количество, так что поиск таких прямых требует
		 константного времени.
	2.4. Все найденные в 2.3. прямые пересекаются с пересечением, 
		 дополнитьельно уменьшая его (вплоть до пустого).

O(1 + n * (1 + n + n + n^2 * n))